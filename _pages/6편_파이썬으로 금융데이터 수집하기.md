---
title: 6편_파이썬으로 금융데이터 수집하기
author: Tao He
date: 2022-02-09
category: Jekyll
layout: post
---

# 1.FinanceDataReader






> 현재 시점의 증권시장별 상장종목을 가져올 수 있다.

> 종목코드, 시장, 종목명, 섹터, 산업군, 상장일, 결산월 등

상장폐지 종목도 조회 가능하다.





##(1) FinanceDataReader 설치하기


!pip install finance_datareader 또는 !pip install —upgrade finance_datareader==0.9.50 등의 형태로 설치 할 수 있다.



```python
!pip install finance_datareader
```

<pre>
Collecting finance_datareader
  Downloading finance_datareader-0.9.50-py3-none-any.whl (19 kB)
Requirement already satisfied: pandas>=0.19.2 in /usr/local/lib/python3.10/dist-packages (from finance_datareader) (1.5.3)
Requirement already satisfied: requests>=2.3.0 in /usr/local/lib/python3.10/dist-packages (from finance_datareader) (2.27.1)
Collecting requests-file (from finance_datareader)
  Downloading requests_file-1.5.1-py2.py3-none-any.whl (3.7 kB)
Requirement already satisfied: lxml in /usr/local/lib/python3.10/dist-packages (from finance_datareader) (4.9.2)
Requirement already satisfied: tqdm in /usr/local/lib/python3.10/dist-packages (from finance_datareader) (4.65.0)
Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.19.2->finance_datareader) (2.8.2)
Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.19.2->finance_datareader) (2022.7.1)
Requirement already satisfied: numpy>=1.21.0 in /usr/local/lib/python3.10/dist-packages (from pandas>=0.19.2->finance_datareader) (1.22.4)
Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests>=2.3.0->finance_datareader) (1.26.16)
Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests>=2.3.0->finance_datareader) (2023.5.7)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.10/dist-packages (from requests>=2.3.0->finance_datareader) (2.0.12)
Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests>=2.3.0->finance_datareader) (3.4)
Requirement already satisfied: six in /usr/local/lib/python3.10/dist-packages (from requests-file->finance_datareader) (1.16.0)
Installing collected packages: requests-file, finance_datareader
Successfully installed finance_datareader-0.9.50 requests-file-1.5.1
</pre>
FinanceDataReader 를 fdr 별칭으로 가져온 후 버젼을 확인해 본다.



```python
import FinanceDataReader as fdr
fdr.__version__
```

<pre>
'0.9.50'
</pre>
##(2) 시장별 종목리스트를 가져오기 (최근일 기준)


코스피, 코스닥, 코넥스 전체 : 'KRX’



NASDAQ(나스닥), NYSE(뉴욕거래소), AMEX(AMEX), S&P 500(S&P 500)



```python
import FinanceDataReader as fdr

stocks = fdr.StockListing('KRX')
stocks
```

<pre>
        Code        ISU_CD     Name  Market   Dept Close ChangeCode  Changes  \
0     060310  KR7060310000       3S  KOSDAQ  중견기업부     -          3      NaN   
1     095570  KR7095570008   AJ네트웍스   KOSPI            -          3      NaN   
2     006840  KR7006840003    AK홀딩스   KOSPI            -          3      NaN   
3     054620  KR7054620000      APS  KOSDAQ  중견기업부     -          3      NaN   
4     265520  KR7265520007    AP시스템  KOSDAQ  우량기업부     -          3      NaN   
...      ...           ...      ...     ...    ...   ...        ...      ...   
2723  000547  KR7000542001  흥국화재2우B   KOSPI            -          3      NaN   
2724  000545  KR7000541003    흥국화재우   KOSPI            -          3      NaN   
2725  003280  KR7003280005     흥아해운   KOSPI            -          3      NaN   
2726  037440  KR7037440005       희림  KOSDAQ  우량기업부     -          3      NaN   
2727  238490  KR7238490007       힘스  KOSDAQ  벤처기업부     -          3      NaN   

      ChagesRatio  Open  High  Low  Volume  Amount  Marcap     Stocks MarketId  
0             NaN   NaN   NaN  NaN     NaN     NaN     NaN   48536642      KSQ  
1             NaN   NaN   NaN  NaN     NaN     NaN     NaN   46822295      STK  
2             NaN   NaN   NaN  NaN     NaN     NaN     NaN   13247561      STK  
3             NaN   NaN   NaN  NaN     NaN     NaN     NaN   20394221      KSQ  
4             NaN   NaN   NaN  NaN     NaN     NaN     NaN   15281421      KSQ  
...           ...   ...   ...  ...     ...     ...     ...        ...      ...  
2723          NaN   NaN   NaN  NaN     NaN     NaN     NaN     153600      STK  
2724          NaN   NaN   NaN  NaN     NaN     NaN     NaN     768000      STK  
2725          NaN   NaN   NaN  NaN     NaN     NaN     NaN  240424899      STK  
2726          NaN   NaN   NaN  NaN     NaN     NaN     NaN   13922475      KSQ  
2727          NaN   NaN   NaN  NaN     NaN     NaN     NaN   11312236      KSQ  

[2728 rows x 17 columns]
</pre>

```python
len(stocks)
```

<pre>
2728
</pre>

```python
stocks_kospi = fdr.StockListing("KOSPI")
stocks_kospi
```

<pre>
       Code        ISU_CD     Name Market Dept Close ChangeCode  Changes  \
0    095570  KR7095570008   AJ네트웍스  KOSPI          -          3      NaN   
1    006840  KR7006840003    AK홀딩스  KOSPI          -          3      NaN   
2    027410  KR7027410000      BGF  KOSPI          -          3      NaN   
3    282330  KR7282330000   BGF리테일  KOSPI          -          3      NaN   
4    138930  KR7138930003  BNK금융지주  KOSPI          -          3      NaN   
..      ...           ...      ...    ...  ...   ...        ...      ...   
948  005010  KR7005010004      휴스틸  KOSPI          -          3      NaN   
949  000540  KR7000540005     흥국화재  KOSPI          -          3      NaN   
950  000547  KR7000542001  흥국화재2우B  KOSPI          -          3      NaN   
951  000545  KR7000541003    흥국화재우  KOSPI          -          3      NaN   
952  003280  KR7003280005     흥아해운  KOSPI          -          3      NaN   

     ChagesRatio  Open  High  Low  Volume  Amount  Marcap     Stocks MarketId  
0            NaN   NaN   NaN  NaN     NaN     NaN     NaN   46822295      STK  
1            NaN   NaN   NaN  NaN     NaN     NaN     NaN   13247561      STK  
2            NaN   NaN   NaN  NaN     NaN     NaN     NaN   95716791      STK  
3            NaN   NaN   NaN  NaN     NaN     NaN     NaN   17283906      STK  
4            NaN   NaN   NaN  NaN     NaN     NaN     NaN  325935246      STK  
..           ...   ...   ...  ...     ...     ...     ...        ...      ...  
948          NaN   NaN   NaN  NaN     NaN     NaN     NaN   56188075      STK  
949          NaN   NaN   NaN  NaN     NaN     NaN     NaN   64242645      STK  
950          NaN   NaN   NaN  NaN     NaN     NaN     NaN     153600      STK  
951          NaN   NaN   NaN  NaN     NaN     NaN     NaN     768000      STK  
952          NaN   NaN   NaN  NaN     NaN     NaN     NaN  240424899      STK  

[953 rows x 17 columns]
</pre>
##(3) 데이터 탐색하기


탐색적 데이터 분석(EDA ; Exploratory Data Analysis)은

 Raw data를 가지고 유연하게 탐색하고 데이터를 이해하기 위해 수행되는 과정입니다.

 탐색적 데이터 분석은 주어진 데이터를 시각화, 요약 통계, 그래프 등을 사용하여 조사하고 탐구하는 과정을 포함합니다. 이를 통해 데이터 세트의 중요한 특징과 패턴을 발견하고 데이터의 품질을 평가할 수 있습니다. 탐색적 데이터 분석은 통계적 가설 검정이나 예측 모델링에 대한 준비 작업으로서도 중요한 역할을 합니다.

 탐색적 데이터 분석은 데이터 과학자나 분석가가 데이터에 대한 통찰력을 얻고 초기 가설을 검증하기 위해 필수적인 단계입니다. 이를 통해 데이터의 품질을 평가하고 문제점을 파악하여 보완할 수 있으며, 향후 분석 과정을 계획하는 데 도움이 됩니다.



탐색적 데이터 분석 작업은 다음과 같습니다.

1. 데이터의 구조 확인

2. 결측치와 이상치 처리

3. 데이터 시각화

4. 변수 간 상관 관계 파악

5. 데이터의 특성과 패턴 발견

6. 향후 분석과 모델링에 활용하기 위한 가설 설정







###1) 데이터 행과 열 확인_shape



```python
stocks_kospi = fdr.StockListing('KOSPI')
stocks_kospi.shape
```

<pre>
(953, 17)
</pre>
###2) 데이터 정보 확인_info()



```python
stocks_kospi = fdr.StockListing('KOSPI')
stocks_kospi.info()
```

<pre>
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 953 entries, 0 to 952
Data columns (total 17 columns):
 #   Column       Non-Null Count  Dtype  
---  ------       --------------  -----  
 0   Code         953 non-null    object 
 1   ISU_CD       953 non-null    object 
 2   Name         953 non-null    object 
 3   Market       953 non-null    object 
 4   Dept         953 non-null    object 
 5   Close        953 non-null    object 
 6   ChangeCode   953 non-null    object 
 7   Changes      0 non-null      float64
 8   ChagesRatio  0 non-null      float64
 9   Open         0 non-null      float64
 10  High         0 non-null      float64
 11  Low          0 non-null      float64
 12  Volume       0 non-null      float64
 13  Amount       0 non-null      float64
 14  Marcap       0 non-null      float64
 15  Stocks       953 non-null    int64  
 16  MarketId     953 non-null    object 
dtypes: float64(8), int64(1), object(8)
memory usage: 126.7+ KB
</pre>
###3) 앞 쪽 기본 정보



```python
stocks_kospi.head()
```

<pre>
     Code        ISU_CD     Name Market Dept Close ChangeCode  Changes  \
0  095570  KR7095570008   AJ네트웍스  KOSPI          -          3      NaN   
1  006840  KR7006840003    AK홀딩스  KOSPI          -          3      NaN   
2  027410  KR7027410000      BGF  KOSPI          -          3      NaN   
3  282330  KR7282330000   BGF리테일  KOSPI          -          3      NaN   
4  138930  KR7138930003  BNK금융지주  KOSPI          -          3      NaN   

   ChagesRatio  Open  High  Low  Volume  Amount  Marcap     Stocks MarketId  
0          NaN   NaN   NaN  NaN     NaN     NaN     NaN   46822295      STK  
1          NaN   NaN   NaN  NaN     NaN     NaN     NaN   13247561      STK  
2          NaN   NaN   NaN  NaN     NaN     NaN     NaN   95716791      STK  
3          NaN   NaN   NaN  NaN     NaN     NaN     NaN   17283906      STK  
4          NaN   NaN   NaN  NaN     NaN     NaN     NaN  325935246      STK  
</pre>
###4) 앞 쪽 특정 갯수 정보 보기



```python
stocks_kospi.head(10)
```

<pre>
     Code        ISU_CD      Name Market Dept Close ChangeCode  Changes  \
0  095570  KR7095570008    AJ네트웍스  KOSPI          -          3      NaN   
1  006840  KR7006840003     AK홀딩스  KOSPI          -          3      NaN   
2  027410  KR7027410000       BGF  KOSPI          -          3      NaN   
3  282330  KR7282330000    BGF리테일  KOSPI          -          3      NaN   
4  138930  KR7138930003   BNK금융지주  KOSPI          -          3      NaN   
5  001460  KR7001460005       BYC  KOSPI          -          3      NaN   
6  001465  KR7001461003      BYC우  KOSPI          -          3      NaN   
7  001040  KR7001040005        CJ  KOSPI          -          3      NaN   
8  079160  KR7079160008    CJ CGV  KOSPI          -          3      NaN   
9  00104K  KR700104K010  CJ4우(전환)  KOSPI          -          3      NaN   

   ChagesRatio  Open  High  Low  Volume  Amount  Marcap     Stocks MarketId  
0          NaN   NaN   NaN  NaN     NaN     NaN     NaN   46822295      STK  
1          NaN   NaN   NaN  NaN     NaN     NaN     NaN   13247561      STK  
2          NaN   NaN   NaN  NaN     NaN     NaN     NaN   95716791      STK  
3          NaN   NaN   NaN  NaN     NaN     NaN     NaN   17283906      STK  
4          NaN   NaN   NaN  NaN     NaN     NaN     NaN  325935246      STK  
5          NaN   NaN   NaN  NaN     NaN     NaN     NaN     624615      STK  
6          NaN   NaN   NaN  NaN     NaN     NaN     NaN     215385      STK  
7          NaN   NaN   NaN  NaN     NaN     NaN     NaN   29176998      STK  
8          NaN   NaN   NaN  NaN     NaN     NaN     NaN   47728069      STK  
9          NaN   NaN   NaN  NaN     NaN     NaN     NaN    4226512      STK  
</pre>
##(4) 불러 온 자료 저장하기


###1) CSV(Comma Separated Value) :

CSV 파일 포맷은 데이터 값이 쉽표(comma)로 구분되는 텍스트 파일



```python
!pip install Pandas
import pandas as pd
stocks_kospi.to_csv('krx.csv')
```

<pre>
Requirement already satisfied: Pandas in /usr/local/lib/python3.10/dist-packages (1.5.3)
Requirement already satisfied: python-dateutil>=2.8.1 in /usr/local/lib/python3.10/dist-packages (from Pandas) (2.8.2)
Requirement already satisfied: pytz>=2020.1 in /usr/local/lib/python3.10/dist-packages (from Pandas) (2022.7.1)
Requirement already satisfied: numpy>=1.21.0 in /usr/local/lib/python3.10/dist-packages (from Pandas) (1.22.4)
Requirement already satisfied: six>=1.5 in /usr/local/lib/python3.10/dist-packages (from python-dateutil>=2.8.1->Pandas) (1.16.0)
</pre>
###2) 엑셀로 저장하기



```python
import pandas as pd
stocks_kospi.to_excel('krx.xlsx')
```

###3) 엑셀로 저장하기

pickle로 저장

to_pickle("krx.pkl")

db로 저장하기도 가능



pandas 활용 : 저장된 자료 다시 불러오기



파이썬 pandas 활용하면 저장된 데이터를 불러와서 DataFrame에 저장하게 됨.

read 다음에 파일 형식에 따라 언더바"_" 이거나 마침표"."를 하고 괄호()안에 파일명 기입 (경로)

read_csv(), read_excel(),  read_html()  등

엑셀 파일은 csv 로 저장 가능.



pd.read_excel('경로/파일명.xlsx') : 파일이 xlsx(엑셀)일 경우   

pd.read_csv('경로/파일명.csv') : 파일이 csv일 경우







```python
import pandas as pd
pd.read_csv('krx.csv')
```

<pre>
     Unnamed: 0    Code        ISU_CD     Name Market  Dept Close  ChangeCode  \
0             0  095570  KR7095570008   AJ네트웍스  KOSPI   NaN     -           3   
1             1  006840  KR7006840003    AK홀딩스  KOSPI   NaN     -           3   
2             2  027410  KR7027410000      BGF  KOSPI   NaN     -           3   
3             3  282330  KR7282330000   BGF리테일  KOSPI   NaN     -           3   
4             4  138930  KR7138930003  BNK금융지주  KOSPI   NaN     -           3   
..          ...     ...           ...      ...    ...   ...   ...         ...   
948         948  005010  KR7005010004      휴스틸  KOSPI   NaN     -           3   
949         949  000540  KR7000540005     흥국화재  KOSPI   NaN     -           3   
950         950  000547  KR7000542001  흥국화재2우B  KOSPI   NaN     -           3   
951         951  000545  KR7000541003    흥국화재우  KOSPI   NaN     -           3   
952         952  003280  KR7003280005     흥아해운  KOSPI   NaN     -           3   

     Changes  ChagesRatio  Open  High  Low  Volume  Amount  Marcap     Stocks  \
0        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   46822295   
1        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   13247561   
2        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   95716791   
3        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   17283906   
4        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN  325935246   
..       ...          ...   ...   ...  ...     ...     ...     ...        ...   
948      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   56188075   
949      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   64242645   
950      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN     153600   
951      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN     768000   
952      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN  240424899   

    MarketId  
0        STK  
1        STK  
2        STK  
3        STK  
4        STK  
..       ...  
948      STK  
949      STK  
950      STK  
951      STK  
952      STK  

[953 rows x 18 columns]
</pre>



```python
pd.read_csv('krx.csv', index_col='Name')
```

<pre>
         Unnamed: 0    Code        ISU_CD Market  Dept Close  ChangeCode  \
Name                                                                       
AJ네트웍스            0  095570  KR7095570008  KOSPI   NaN     -           3   
AK홀딩스             1  006840  KR7006840003  KOSPI   NaN     -           3   
BGF               2  027410  KR7027410000  KOSPI   NaN     -           3   
BGF리테일            3  282330  KR7282330000  KOSPI   NaN     -           3   
BNK금융지주           4  138930  KR7138930003  KOSPI   NaN     -           3   
...             ...     ...           ...    ...   ...   ...         ...   
휴스틸             948  005010  KR7005010004  KOSPI   NaN     -           3   
흥국화재            949  000540  KR7000540005  KOSPI   NaN     -           3   
흥국화재2우B         950  000547  KR7000542001  KOSPI   NaN     -           3   
흥국화재우           951  000545  KR7000541003  KOSPI   NaN     -           3   
흥아해운            952  003280  KR7003280005  KOSPI   NaN     -           3   

         Changes  ChagesRatio  Open  High  Low  Volume  Amount  Marcap  \
Name                                                                     
AJ네트웍스       NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
AK홀딩스        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
BGF          NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
BGF리테일       NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
BNK금융지주      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
...          ...          ...   ...   ...  ...     ...     ...     ...   
휴스틸          NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
흥국화재         NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
흥국화재2우B      NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
흥국화재우        NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   
흥아해운         NaN          NaN   NaN   NaN  NaN     NaN     NaN     NaN   

            Stocks MarketId  
Name                         
AJ네트웍스    46822295      STK  
AK홀딩스     13247561      STK  
BGF       95716791      STK  
BGF리테일    17283906      STK  
BNK금융지주  325935246      STK  
...            ...      ...  
휴스틸       56188075      STK  
흥국화재      64242645      STK  
흥국화재2우B     153600      STK  
흥국화재우       768000      STK  
흥아해운     240424899      STK  

[953 rows x 17 columns]
</pre>
###4) 경로 저장된 자료 불러오기

파일 경로 찾는 법 : 불러올 파일을 마우스 우클릭 --> 속성 --> 위치에서 경로 확인

C:\Users\user\Desktop  --> \ 를 /로 바꿔주기

C:/Users/user/Desktop  *(/를 인식할 떄도 있고 \를 인식 할 때도 있는 것 같다 되는 걸 쓰자)



encoding = 'utf-8'

글자를 읽어 올 떄 utf-8의 약속대로 읽어오라는 의미

왠만하면 이걸로 꺠진 글씨들을 읽어 올 수 있다.



encoding = '인코딩 방식'

글자를 읽어 올때 어떠한 방식으로 익어 올 것인지 지정하는 것

대부분 encoding = utf-8 을 기입하면 된다.



data = pd.read_csv('파일경로 or url', sep='\t', engine = 'python', encoding = 'utf-8')



data = pd.read_csv('파일경로 or url', sep =',' , encoding = '인코딩 방식')



pd.read_csv("C:/finance_data/titanic.csv", engine = 'python', encoding = 'utf-8')



pd.read_excel("C:/finance_data.titanic.csv")


##(5) 해외시장 데이터 가져오기


: 'NASDAQ', 'NYSE', 'AMEX' and 'S&P500', 'SSE'(상해), 'SZSE'(심천), 'HKEX'(홍콩), 'TSE'(도쿄)



KRX delistings: 'KRX-DELISTING'(상장폐지종목), 'KRX-ADMINISTRATIVE' (관리종목)

ETF Symbol listings(for multiple countries): 'KR', 'US', 'JP'


##(6) 개별종목 주가 가져오기

삼성전자(005930) 전체 (1996-11-05 ~ 현재)



```python
import FinanceDataReader as fdr

df = fdr.DataReader('005930')
df
```

<pre>
             Open   High    Low  Close    Volume    Change
Date                                                      
1999-03-17   1751   1761   1712   1722    398828       NaN
1999-03-18   1735   1800   1723   1736    606874  0.008130
1999-03-19   1761   1894   1759   1853   1298440  0.067396
1999-03-22   1878   2025   1841   1947   1575773  0.050729
1999-03-23   1956   1995   1923   1937    641837 -0.005136
...           ...    ...    ...    ...       ...       ...
2023-06-22  70200  71500  70100  71300  11411007  0.011348
2023-06-23  72000  72200  71600  71600  12329484  0.004208
2023-06-26  71700  72500  71500  72400  10541901  0.011173
2023-06-27  72500  72600  72000  72600   9442997  0.002762
2023-06-28  72600  72600  72200  72300   1968859 -0.004132

[6000 rows x 6 columns]
</pre>

```python
df.head()
```

<pre>
            Open  High   Low  Close   Volume    Change
Date                                                  
1999-03-17  1751  1761  1712   1722   398828       NaN
1999-03-18  1735  1800  1723   1736   606874  0.008130
1999-03-19  1761  1894  1759   1853  1298440  0.067396
1999-03-22  1878  2025  1841   1947  1575773  0.050729
1999-03-23  1956  1995  1923   1937   641837 -0.005136
</pre>

```python
df.tail(10)
```

<pre>
             Open   High    Low  Close    Volume    Change
Date                                                      
2023-06-15  72100  72300  71300  71500  13614994 -0.005563
2023-06-16  71800  71900  70900  71800  15373696  0.004196
2023-06-19  71300  71700  70900  71200  11100887 -0.008357
2023-06-20  70700  71400  70400  71400  11557883  0.002809
2023-06-21  70700  71200  70400  70500  10626603 -0.012605
2023-06-22  70200  71500  70100  71300  11411007  0.011348
2023-06-23  72000  72200  71600  71600  12329484  0.004208
2023-06-26  71700  72500  71500  72400  10541901  0.011173
2023-06-27  72500  72600  72000  72600   9442997  0.002762
2023-06-28  72600  72600  72200  72300   1968859 -0.004132
</pre>
##(7)　특정 기간에 이후부터 현재까지 개별 종목 주가 가져오기

Date 주식시장 날짜  

  



Open 시가# High 고가# Low 저가# Close 종가  

Volume 해당 개장일의 거래량  

Change는 해당 개장일의 전날 대비 종가 상승률



```python
import FinanceDataReader as fdr
fdr.DataReader('005930', start = '2020').reset_index()
```

<pre>
          Date   Open   High    Low  Close    Volume    Change
0   2020-01-02  55500  56000  55000  55200  12993228 -0.010753
1   2020-01-03  56000  56600  54900  55500  15422255  0.005435
2   2020-01-06  54900  55600  54600  55500  10278951  0.000000
3   2020-01-07  55700  56400  55600  55800  10009778  0.005405
4   2020-01-08  56200  57400  55900  56800  23501171  0.017921
..         ...    ...    ...    ...    ...       ...       ...
858 2023-06-22  70200  71500  70100  71300  11411007  0.011348
859 2023-06-23  72000  72200  71600  71600  12329484  0.004208
860 2023-06-26  71700  72500  71500  72400  10541901  0.011173
861 2023-06-27  72500  72600  72000  72600   9442997  0.002762
862 2023-06-28  72600  72600  72200  72200   1979649 -0.005510

[863 rows x 7 columns]
</pre>
##(8) 특정 기간에 대하여 개별 종목 주가 가져오기



```python
start_date = '2022-01-03'
end_date = '2022-10-25'
df_fdr = fdr.DataReader('005930', start=start_date, end=end_date)
df_fdr
```

<pre>
             Open   High    Low  Close    Volume    Change
Date                                                      
2022-01-03  79400  79800  78200  78600  13502112  0.003831
2022-01-04  78800  79200  78300  78700  12427416  0.001272
2022-01-05  78800  79000  76400  77400  25470640 -0.016518
2022-01-06  76700  77600  76600  76900  12931954 -0.006460
2022-01-07  78100  78400  77400  78300  15163757  0.018205
...           ...    ...    ...    ...       ...       ...
2022-10-19  56700  56900  55700  55800  12660652 -0.012389
2022-10-20  55200  56000  55100  55500  17107653 -0.005376
2022-10-21  55100  56300  55100  55900  11456060  0.007207
2022-10-24  57000  57500  56700  57500  16944503  0.028623
2022-10-25  57000  58600  57000  57700  17405678  0.003478

[199 rows x 6 columns]
</pre>
##(9)　참고

한국 지수

KS11	KOSPI 지수,  

KQ11	KOSDAQ 지수  

KS50	KOSPI 50 지수  

KS100	KOSPI 100  

KRX100	KRX 100  

KS200	코스피 200   

미국 지수  

DJI	다우존스 지수  

IXIC	나스닥 지수  

US500	S&P 500 지수  

VIX	S&P 500 VIX  

국가별 주요 지수  

JP225	닛케이 225 선물  

STOXX50E	Euro Stoxx 50  

CSI300	CSI 300 (중국)  

HSI	항셍 (홍콩)  

FTSE	영국 FTSE  

DAX	독일 DAX 30  

CAC	프랑스 CAC 40  

환율  

USD/KRW	달러당 원화 환율  

USD/EUR	달러당 유로화 환율  

USD/JPY	달러당 엔화 환율  

CNY/KRW	위엔화 원화 환율  

EUR/USD	유로화 달러 환율  

USD/JPY	달러 엔화 환율  

JPY/KRW	엔화 원화 환율  

AUD/USD	오스트레일리아 달러 환율  

EUR/JPY	유로화 엔화 환율  

USD/RUB	달러 루블화  

암호화폐 가격(KRW)  

BTC/KRW	비트코인 원화 가격  

ETH/KRW	이더리움 원화 가격  

XRP/KRW	리플 원화 가격  

BCH/KRW	비트코인 캐시 원화 가격  

EOS/KRW	이오스 원화 가격  

LTC/KRW	라이트 코인 원화 가격  

XLM/KRW	스텔라 원화 가격  


#제2절 시각화

#1.그래픽 종류

line	line graph  

pie	pie chart  

scatter	scatter plot  

bar, barh	vertical, horizontal bar charts  

area	area plots  

box	box plot  

hexbin	hexbin plot  

hist	histogram  

kde, density	kernel density charts


#(1) 라인 그래프로 보여주기



```python
df = fdr.DataReader('005930', '2020')
df ['Close'].plot()
```

<pre>
<Axes: xlabel='Date'>
</pre>
<pre>
<Figure size 640x480 with 1 Axes>
</pre>
##(2) 막대그래프 보여주기



```python
df ['Close'].hist()
```

<pre>
<Axes: >
</pre>
<pre>
<Figure size 640x480 with 1 Axes>
</pre>
###1) 같은 연도를 쓰면 나오지 않음



```python
import FinanceDataReader as fdr
fdr.DataReader('005930', start = '2021', end = '2021')
```

<pre>
Empty DataFrame
Columns: [Open, High, Low, Close, Volume, Change]
Index: []
</pre>
###2) 2021년 주가 가져오기



```python
import FinanceDataReader as fdr
fdr.DataReader('005930', start = '2021', end = '2022')
```

<pre>
             Open   High    Low  Close    Volume    Change
Date                                                      
2021-01-04  81000  84400  80200  83000  38655276  0.024691
2021-01-05  81600  83900  81600  83900  35335669  0.010843
2021-01-06  83300  84500  82100  82200  42089013 -0.020262
2021-01-07  82800  84200  82700  82900  32644642  0.008516
2021-01-08  83300  90000  83000  88800  59013307  0.071170
...           ...    ...    ...    ...       ...       ...
2021-12-24  80200  80800  80200  80500  12086380  0.007509
2021-12-27  80600  80600  79800  80200  10783368 -0.003727
2021-12-28  80200  80400  79700  80300  18226325  0.001247
2021-12-29  80200  80200  78500  78800  19794795 -0.018680
2021-12-30  78900  79500  78100  78300  14236700 -0.006345

[248 rows x 6 columns]
</pre>
#2. pykrx

https://github.com/sharebook-kr/pykrx



KRX, Naver 등의 웹사이트에서 주가정보를 스크래핑하는 모듈



특정 시점의 상장 종목코드 조회 가능

해당 종목코드의 종목명을 조회하는 함수가 별도로 존재


##(1) 설치하기

pykrx의 stock 모듈을 import 한 후 다른 작업 진행



```python
!pip install pykrx
```

<pre>
Requirement already satisfied: pykrx in /usr/local/lib/python3.10/dist-packages (1.0.42)
Requirement already satisfied: requests in /usr/local/lib/python3.10/dist-packages (from pykrx) (2.27.1)
Requirement already satisfied: pandas in /usr/local/lib/python3.10/dist-packages (from pykrx) (1.5.3)
Requirement already satisfied: datetime in /usr/local/lib/python3.10/dist-packages (from pykrx) (5.1)
Requirement already satisfied: numpy in /usr/local/lib/python3.10/dist-packages (from pykrx) (1.22.4)
Requirement already satisfied: xlrd in /usr/local/lib/python3.10/dist-packages (from pykrx) (2.0.1)
Requirement already satisfied: deprecated in /usr/local/lib/python3.10/dist-packages (from pykrx) (1.2.14)
Requirement already satisfied: multipledispatch in /usr/local/lib/python3.10/dist-packages (from pykrx) (0.6.0)
Requirement already satisfied: matplotlib in /usr/local/lib/python3.10/dist-packages (from pykrx) (3.7.1)
Requirement already satisfied: zope.interface in /usr/local/lib/python3.10/dist-packages (from datetime->pykrx) (6.0)
Requirement already satisfied: pytz in /usr/local/lib/python3.10/dist-packages (from datetime->pykrx) (2022.7.1)
Requirement already satisfied: wrapt<2,>=1.10 in /usr/local/lib/python3.10/dist-packages (from deprecated->pykrx) (1.14.1)
Requirement already satisfied: contourpy>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (1.1.0)
Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (0.11.0)
Requirement already satisfied: fonttools>=4.22.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (4.40.0)
Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (1.4.4)
Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (23.1)
Requirement already satisfied: pillow>=6.2.0 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (8.4.0)
Requirement already satisfied: pyparsing>=2.3.1 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (3.1.0)
Requirement already satisfied: python-dateutil>=2.7 in /usr/local/lib/python3.10/dist-packages (from matplotlib->pykrx) (2.8.2)
Requirement already satisfied: six in /usr/local/lib/python3.10/dist-packages (from multipledispatch->pykrx) (1.16.0)
Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.10/dist-packages (from requests->pykrx) (1.26.16)
Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.10/dist-packages (from requests->pykrx) (2023.5.7)
Requirement already satisfied: charset-normalizer~=2.0.0 in /usr/local/lib/python3.10/dist-packages (from requests->pykrx) (2.0.12)
Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.10/dist-packages (from requests->pykrx) (3.4)
Requirement already satisfied: setuptools in /usr/local/lib/python3.10/dist-packages (from zope.interface->datetime->pykrx) (67.7.2)
</pre>
##(2) 데이터 불러오기

① "get_market_ticker_list" 메서드는 주식 종목들을 가져오기  

② "get_market_ticker_name" 메서드는 심볼(티커)을 받으면 기업 이름을 가져오기



KOSPI/KOSDAQ/KONEX 종목코드 조회



```python
from pykrx import stock

stock_code = stock.get_market_ticker_list(date="20220630", market="ALL")
(stock_code[:6], len(stock_code))
```

<pre>
(['060310', '095570', '006840', '054620', '265520', '211270'], 2629)
</pre>
KOSPI 종목코드 조회



```python
stock_code = stock.get_market_ticker_list(date='20220928', market='KOSPI')
(stock_code[:6], len(stock_code))
```

<pre>
(['095570', '006840', '027410', '282330', '138930', '001460'], 939)
</pre>

```python
kospi = stock.get_market_ticker_list('20220617', market='KOSPI')
kospi[:5]
```

<pre>
['095570', '006840', '027410', '282330', '138930']
</pre>
KOSDAQ 종목코드 조회



```python
stock_code = stock.get_market_ticker_list(date='20220928', market='KOSDAQ')
(stock_code[:6], len(stock_code))
```

<pre>
(['060310', '054620', '265520', '211270', '032790', '013720'], 1582)
</pre>
종목명 반환



```python
stock_name = stock.get_market_ticker_name('005930')
stock_name
```

<pre>
'삼성전자'
</pre>
##(3) "get_market_ohlcv" 메서드는 OHLCV 주식 시세를 가져오기

일자별 OHLCV(시가, 고가, 저가, 종가, 거래량) 조회¶


삼성전자의 20220101~20220920의 주가데이터



```python
df = stock.get_market_ohlcv_by_date(fromdate="20220101", todate="20220920", ticker="005930")
df
```

<pre>
               시가     고가     저가     종가       거래량           거래대금   등락률
날짜                                                                   
2022-01-03  79400  79800  78200  78600  13502112  1066006837750  0.38
2022-01-04  78800  79200  78300  78700  12427416   977990613000  0.13
2022-01-05  78800  79000  76400  77400  25470640  1967841509800 -1.65
2022-01-06  76700  77600  76600  76900  12931954   996378432570 -0.65
2022-01-07  78100  78400  77400  78300  15163757  1184236552700  1.82
...           ...    ...    ...    ...       ...            ...   ...
2022-09-14  56200  57200  56100  56800  12524961   709906007000 -2.24
2022-09-15  57000  57100  56000  56000  11664819   657641711500 -1.41
2022-09-16  55600  56400  55500  56200  13456503   752455682838  0.36
2022-09-19  56300  57000  56000  56400  12278653   693636680000  0.36
2022-09-20  56400  57000  55800  55800  14041465   788331519815 -1.06

[176 rows x 7 columns]
</pre>
##(4) 일정 기간 종목의 가격 변동 조회 Permalink

get_market_price_change_by_ticker(fromdate=”조회시작일”,todate=”조회종료일”, market=”거래소명”)



```python
```


```python
df = stock.get_market_price_change_by_ticker(fromdate='20220801', todate='20220920')
df.head()
```

<pre>
            종목명      시가      종가    변동폭   등락률       거래량          거래대금
티커                                                                  
095570   AJ네트웍스    8030    7830   -200 -2.49   5463509   43102591480
006840    AK홀딩스   16350   15750   -600 -3.67    344494    5587561800
027410      BGF    4215    3900   -315 -7.47   4444087   18277872435
282330   BGF리테일  181000  164000 -17000 -9.39   1947992  322270114000
138930  BNK금융지주    6790    6610   -180 -2.65  34970261  234444930075
</pre>
##(5) 특정 일자 전체 종목 시세 OHLCV(시가, 고가, 저가, 종가, 거래량, 거래대금, 등락률) 가져오기

stock.get_market_ohlcv_by_ticker(date=날짜)



```python
df = stock.get_market_ohlcv_by_ticker(date="20220920")
df.head()
```

<pre>
            시가      고가      저가      종가      거래량         거래대금   등락률
티커                                                                
095570    7980    8140    7830    7830   214050   1707067150  0.64
006840   15300   15800   15300   15750     7227    112495150  1.29
027410    3845    3925    3805    3900   119734    466020190  1.43
282330  166000  168000  162500  164000    73238  12111634000 -0.30
138930    6580    6660    6550    6610  1139966   7534064600  0.76
</pre>
##(6) 개별종목 날짜별 OHLCV(시가, 고가, 저가, 종가, 거래량, 거래대금, 등락률) 가져오기

stock.get_market_ohlcv_by_date(조회시작일, 조회종료일, 종목코드)



```python
df = stock.get_market_ohlcv_by_date("20220820", "20220925", "005930")
df.head()
```

<pre>
               시가     고가     저가     종가      거래량          거래대금   등락률
날짜                                                                 
2022-08-22  60300  60400  59800  60000  8259865  495732266100 -1.48
2022-08-23  59000  59600  59000  59100  9041629  535657353300 -1.50
2022-08-24  59200  59500  59000  59000  8888486  525406965200 -0.17
2022-08-25  59200  59700  59000  59700  5767902  342780937200  1.19
2022-08-26  60300  60900  59900  60000  9499995  573040309950  0.50
</pre>

```python
df = stock.get_market_ohlcv_by_date("20220820", "20220925", "005930")
df
```

<pre>
               시가     고가     저가     종가       거래량           거래대금   등락률
날짜                                                                   
2022-08-22  60300  60400  59800  60000   8259865   495732266100 -1.48
2022-08-23  59000  59600  59000  59100   9041629   535657353300 -1.50
2022-08-24  59200  59500  59000  59000   8888486   525406965200 -0.17
2022-08-25  59200  59700  59000  59700   5767902   342780937200  1.19
2022-08-26  60300  60900  59900  60000   9499995   573040309950  0.50
2022-08-29  58700  58900  58600  58600   9841329   577684200900 -2.33
2022-08-30  58700  59000  58300  58800   9690044   567627668500  0.34
2022-08-31  58200  59900  58200  59700  14203512   841319635900  1.53
2022-09-01  58700  58900  58300  58400  14905777   872374620601 -2.18
2022-09-02  58300  58600  57500  57500  15040310   872040367551 -1.54
2022-09-05  57400  57800  56800  57100  11425977   653884056584 -0.70
2022-09-06  57200  57600  56900  57100   7503086   429152038700  0.00
2022-09-07  56700  56700  55900  56000  17384854   975695179700 -1.93
2022-09-08  56200  56400  55600  55600  18000016  1006366398000 -0.71
2022-09-13  57000  58500  56800  58100  17166581   991015891355  4.50
2022-09-14  56200  57200  56100  56800  12524961   709906007000 -2.24
2022-09-15  57000  57100  56000  56000  11664819   657641711500 -1.41
2022-09-16  55600  56400  55500  56200  13456503   752455682838  0.36
2022-09-19  56300  57000  56000  56400  12278653   693636680000  0.36
2022-09-20  56400  57000  55800  55800  14041465   788331519815 -1.06
2022-09-21  55400  55500  55000  55300  11863700   655017421100 -0.90
2022-09-22  54600  54700  54300  54400  12786510   696058101600 -1.63
2022-09-23  54400  54900  54200  54500  10555964   575503622100  0.18
</pre>
##(7) 전체 종목의 펀더멘탈 지표(PER, PBR, EPS, BPS, DIV, DPS) 가져오기

stock.get_market_fundamental_by_ticker(date=날짜, market=거래소)



market의 기본값은 "ALL"



DIV(배당수익률): (주가배당금/주가) * 100



BPS(주당순자산가치=청산가치): (순자산)/(총발행주식수)



PER(주가수익비율): (주가)/(주당순이익)



EPS(주당순이익): (당기순이익)/(총발행주식수)



PBR(주가순자산비율) = (주가)/(BPS) = PER*EPS / BPS



```python
df = stock.get_market_fundamental_by_ticker(date='20220617', market="ALL")
df.head()
```

<pre>
          BPS     PER   PBR   EPS   DIV  DPS
티커                                          
060310    792  174.69  3.53    16  0.00    0
095570   8075    3.95  0.84  1707  4.00  270
006840  45961    0.00  0.37     0  1.17  200
054620  10088    8.07  0.94  1179  1.05  100
265520  12713    4.88  1.51  3932  1.25  240
</pre>
특정일자의 종목별 DIV/BPS/PER/EPS 조회  

get_market_fundamental_by_ticker (date="YYYYMMDD", market="거래소명")



```python
df = stock.get_market_fundamental_by_ticker(date='20210520')
df.head()
```

<pre>
          BPS    PER   PBR   EPS   DIV   DPS
티커                                          
095570   6089   0.00  0.96     0  3.61   210
006840  50471   0.00  0.69     0  1.14   400
027410  15781  23.93  0.43   285  1.61   110
282330  40317  25.06  4.42  7103  1.35  2400
138930  26781   5.31  0.30  1498  4.02   320
</pre>
일자별 개별종목 DIV/BPS/PER/EPS 조회

get_market_fundamental_by_date(fromdate, todate, ticker, freq='d', name_display=False)



freq: d(일), m(월), y(연도)



```python
df = stock.get_market_fundamental_by_date(fromdate="20200101", todate="20211231", ticker="005930")
df
```

<pre>
              BPS    PER   PBR   EPS   DIV   DPS
날짜                                              
2020-01-02  35342   8.54  1.56  6461  2.57  1416
2020-01-03  35342   8.59  1.57  6461  2.55  1416
2020-01-06  35342   8.59  1.57  6461  2.55  1416
2020-01-07  35342   8.64  1.58  6461  2.54  1416
2020-01-08  35342   8.79  1.61  6461  2.49  1416
...           ...    ...   ...   ...   ...   ...
2021-12-24  39406  20.96  2.04  3841  3.72  2994
2021-12-27  39406  20.88  2.04  3841  3.73  2994
2021-12-28  39406  20.91  2.04  3841  3.73  2994
2021-12-29  39406  20.52  2.00  3841  3.80  2994
2021-12-30  39406  20.39  1.99  3841  3.82  2994

[496 rows x 6 columns]
</pre>
frequency 파라미터(d/m/y)를 추가



```python
df = stock.get_market_fundamental_by_date("20200101", "20200203", "005930", freq="m")
df.head(2)
```

<pre>
              BPS   PER   PBR   EPS   DIV   DPS
날짜                                             
2020-01-31  35342  8.54  1.56  6461  2.57  1416
2020-02-29  35342  8.85  1.62  6461  2.48  1416
</pre>

```python
df = stock.get_market_fundamental_by_date(fromdate="20200101", todate="20211231", ticker="005930")
df.head()
```

<pre>
              BPS   PER   PBR   EPS   DIV   DPS
날짜                                             
2020-01-02  35342  8.54  1.56  6461  2.57  1416
2020-01-03  35342  8.59  1.57  6461  2.55  1416
2020-01-06  35342  8.59  1.57  6461  2.55  1416
2020-01-07  35342  8.64  1.58  6461  2.54  1416
2020-01-08  35342  8.79  1.61  6461  2.49  1416
</pre>

```python
df = stock.get_market_ohlcv("20150720", "20150810", "005930")
df.head(3)
```

<pre>
                 시가       고가       저가       종가     거래량          거래대금   등락률
날짜                                                                        
2015-07-20  1291000  1304000  1273000  1275000  128928  165366199000 -2.30
2015-07-21  1275000  1277000  1247000  1263000  194055  244129106000 -0.94
2015-07-22  1244000  1260000  1235000  1253000  268323  333813094000 -0.79
</pre>
##(7) 거래량, 거래대금 조회하기

지정된 기간 동안의 일자별로 정렬된 (순매수) 거래량



```python
df = stock.get_market_trading_value_by_date("20210101", "20210701", "005930")
df.head()
```

<pre>
                    기관합계         기타법인             개인         외국인합계  전체
날짜                                                                    
2021-01-04 -326136950200  48480486000   658901836000 -381245371800   0
2021-01-05 -203963791100   7236010900   622727193300 -425999413100   0
2021-01-06 -442463559600  13521042200  1013153304900 -584210787500   0
2021-01-07  250129976600  17802746700   -71008181500 -196924541800   0
2021-01-08 -436089196200   1958064400  -169881010800  604012142600   0
</pre>
매수 혹은 매도 금액을 조회하고 싶다면 on 파라미터에 입력할 수 있습니다. 입력하지 않는다면 순매수 금액이 조회



```python
df = stock.get_market_trading_value_by_date("20210115", "20210122", "005930", on="매도")
df.head()
```

<pre>
                     기관합계         기타법인             개인         외국인합계  \
날짜                                                                    
2021-01-15  1505250243300  19525756900   925426195700  525029741764   
2021-01-18  1353223733500  22132983500  1883422627200  456996648400   
2021-01-19  1205081446400  28155090000  1800734616800  407371601300   
2021-01-20  1147190346800  10015618200   643413644500  405119540200   
2021-01-21   878411497500  41184362100   851899126900  439714802000   

                       전체  
날짜                         
2021-01-15  2975231937664  
2021-01-18  3715775992600  
2021-01-19  3441342754500  
2021-01-20  2205739149700  
2021-01-21  2211209788500  
</pre>

```python
df = stock.get_market_trading_value_by_date("20210115", "20210122", "005930", on="매수")
df.head()
```

<pre>
                     기관합계         기타법인             개인         외국인합계  \
날짜                                                                    
2021-01-15  1064481034000  44968044700  1587035281300  278747577664   
2021-01-18  1395547268500  44815328300  1898251748900  377161646900   
2021-01-19  1300604499900  24904667500  1627250403500  488583183600   
2021-01-20   782714132800  32996251100  1073529225500  316499540300   
2021-01-21   817773991200  13303508100  1102184636900  277947652300   

                       전체  
날짜                         
2021-01-15  2975231937664  
2021-01-18  3715775992600  
2021-01-19  3441342754500  
2021-01-20  2205739149700  
2021-01-21  2211209788500  
</pre>
시장의 거래대금을 조회할 때는 ETF, ETN ELW의 포함 여부를 지정할 수 있습니다.  

만약 값을 지정하지 않는다면 해당 데이터를 제외한 값을 반환합니다.



```python
df = stock.get_market_trading_value_by_date("20210115", "20210122", "KOSPI", etf=True, etn=True, elw=True)
df.head()
```

<pre>
                     기관합계         기타법인             개인         외국인합계  전체
날짜                                                                     
2021-01-15 -1536570309441  63110174617  2251672617980 -778212483156   0
2021-01-18  -601428111357 -27000808439   494341183227  134087736569   0
2021-01-19   544654406338  21787409868  -968965427363  402523611157   0
2021-01-20 -1227642472619  32139813590  1444113501769 -248610842740   0
2021-01-21  -284899892322 -19072459127   -61503500921  365475852370   0
</pre>
일자별 시장의 거래량을 조회



```python
df = stock.get_market_trading_volume_by_date("20220101", "20220701", "005930")
df.head()
```

<pre>
               기관합계    기타법인       개인    외국인합계  전체
날짜                                               
2022-01-03 -4178268   60481  2349662  1768125   0
2022-01-04 -2623794   24292  1170907  1428595   0
2022-01-05 -7727282 -103764  8414591  -583545   0
2022-01-06 -2229379   51631   -41729  2219477   0
2022-01-07 -2115197  -49515 -2194573  4359285   0
</pre>
매수 혹은 매도 거래량만을 조회하고 싶다면 on 파라미터에 입력 가능  

입력하지 않는다면 순매수 수량이 조회



```python
df = stock.get_market_trading_volume_by_date("20220101", "20220701", "005930", on="매도")
df.head()
```

<pre>
                기관합계    기타법인       개인    외국인합계        전체
날짜                                                      
2022-01-03   8759701   21053  2807663  1913695  13502112
2022-01-04   8463883   26174  2332823  1604536  12427416
2022-01-05  15538421  246850  4129142  5556227  25470640
2022-01-06   7164696   54432  3801704  1911122  12931954
2022-01-07   7090895  142380  5006070  2924412  15163757
</pre>
지정된 기간 동안의 투자자별로 정렬된 (순매수) 거래대금



```python
df = stock.get_market_trading_value_by_investor("20210101", "20210701", "005930")
df.head()
```

<pre>
                   매도              매수            순매수
투자자구분                                               
금융투자   31066223912100  28464867937600 -2601355974500
보험      1808485504300    779839009100 -1028646495200
투신      3177067544700   1794360840100 -1382706704600
사모      1259026093300    955202197900  -303823895400
은행       149110410100     87504448700   -61605961400
</pre>
세 번째 파라미터에 KOSPI, KOSDAQ, KONEX를 지정하면 각 시장의 거래대금을 조회  

ALL을 입력하면 세 개의 시장을 합친 통합 거래대금을 조회



```python
df = stock.get_market_trading_value_by_investor("20210101", "20210701", "KOSPI")
df.head()
```

<pre>
                    매도               매수            순매수
투자자구분                                                 
금융투자   129106291931852  124118597123721 -4987694808131
보험      14553591609599   11217910114022 -3335681495577
투신      30145646816976   25894892024771 -4250754792205
사모      16717352065581   13748646227789 -2968705837792
은행       2106750785171     829995794830 -1276754990341
</pre>
시장의 거래대금을 조회할 때는 ETF, ETN ELW의 포함 여부를 지정 가능  

만약 값을 지정하지 않는다면 해당 데이터를 제외한 값을을 반환  

옵션은 KOSPI, KOSDAQ, KONEX 조회할 때만 유효  



```python
df = stock.get_market_trading_value_by_investor("20210115", "20210122", "KOSPI", etf=True, etn=True, elw=True)
df.head()
```

<pre>
                   매도              매수           순매수
투자자구분                                              
금융투자   15985568261831  15006116511544 -979451750287
보험      1219035502445    757575677208 -461459825237
투신      2235561259511   1799363743367 -436197516144
사모       999084910863    846067212945 -153017697918
은행       886226324790    936210985810   49984661020
</pre>
지정된 기간 동안의 투자자별로 정렬된 (순매수) 거래량



```python
df = stock.get_market_trading_volume_by_investor("20210115", "20210122", "005930")
df.head()
```

<pre>
             매도        매수      순매수
투자자구분                             
금융투자   29455909  26450600 -3005309
보험      1757287    509535 -1247752
투신      2950680   1721970 -1228710
사모       745727    696135   -49592
은행        38675     46394     7719
</pre>
##(8) 종목별 시총 가져오기

get_market_cap_by_ticker 함수는 특정 일자의 종목별 시가총액/거래량/거래대금/상장주식수/외국인보유주식수를 조회  

외국인보유주식수는 D-2 (영업일 기준)일 까지 유효한 값이 출력되며, D-1일은 0으로 표기  



```python
df = stock.get_market_cap_by_ticker("20220901")
df.head()
```

<pre>
            종가             시가총액       거래량          거래대금       상장주식수
티커                                                                 
005930   58400  348635300920000  14905777  872374620601  5969782550
373220  463000  108342000000000    289808  134255218000   234000000
000660   92400   67267418526000   2337521  216798395700   728002365
207940  826000   58789724000000     51619   42488586000    71174000
005935   53700   44189015790000   1047819   56430850600   822886700
</pre>
일자별 시가 총액 조회  

get_market_cap_by_date 함수는 특정 종목의 일자별 시가총액을 조회  

거래량/거래대금/상장주식수가 함께 조회  



```python
df = stock.get_market_cap_by_date("20220101", "20220701", "005930")
df
```

<pre>
                       시가총액       거래량           거래대금       상장주식수
날짜                                                              
2022-01-03  469224908430000  13502112  1066006837750  5969782550
2022-01-04  469821886685000  12427416   977990613000  5969782550
2022-01-05  462061169370000  25470640  1967841509800  5969782550
2022-01-06  459076278095000  12931954   996378432570  5969782550
2022-01-07  467433973665000  15163757  1184236552700  5969782550
...                     ...       ...            ...         ...
2022-06-27  351023213940000  18122236  1071186745402  5969782550
2022-06-28  354605083470000  13540538   800041009700  5969782550
2022-06-29  346247387900000  14677138   855770425874  5969782550
2022-06-30  340277605350000  18915142  1082799462452  5969782550
2022-07-01  335501779310000  24982097  1412473217495  5969782550

[122 rows x 4 columns]
</pre>
get_market_cap_by_date() 함수에 frequency 파라미터(d/m/y)를 추가  

d는 일자, m은 월, y는 연도를 의미  

시가총액과 상장주식수는 월별 마지막 거래일의 값을 사용



```python
df = stock.get_market_cap_by_date("20220101", "20220701", "005930", "m")
df.head()
```

<pre>
                       시가총액        거래량            거래대금       상장주식수
날짜                                                                
2022-01-31  437585060915000  280187100  21353687791872  5969782550
2022-02-28  430421321855000  233201135  17162868317227  5969782550
2022-03-31  415496865480000  307432780  21623031900069  5969782550
2022-04-30  402363343870000  309880731  20862445445512  5969782550
2022-05-31  402363343870000  310129252  20749258205428  5969782550
</pre>
시가총액과 상장주식수는 월별 마지막 거래일의 값을 사용



```python
df = stock.get_market_cap_by_date("20220101", "20220701", "005930", "m")
df
```

<pre>
                       시가총액        거래량            거래대금       상장주식수
날짜                                                                
2022-01-31  437585060915000  280187100  21353687791872  5969782550
2022-02-28  430421321855000  233201135  17162868317227  5969782550
2022-03-31  415496865480000  307432780  21623031900069  5969782550
2022-04-30  402363343870000  309880731  20862445445512  5969782550
2022-05-31  402363343870000  310129252  20749258205428  5969782550
2022-06-30  340277605350000  428473209  26052954770686  5969782550
2022-07-31  335501779310000   24982097   1412473217495  5969782550
</pre>
get_exhaustion_rates_of_foreign_investment_by_ticker 함수  

상장주식수/외국인한도수량/외국인보유수량/외국인한도소진률 정보를 조회  

외국인 보유수량 및 한도소진율은 장개시 시점 기준(금융감독원 외국인투자 관리시스템 제공 전일자 확정치)  



```python
df = stock.get_exhaustion_rates_of_foreign_investment_by_ticker('20210701')
df
```

<pre>
            상장주식수      보유수량        지분율       한도수량      한도소진률
티커                                                          
000020   27931470    828117   2.960938   27931470   2.960938
000040   96137368  44241720  46.031250   96137368  46.031250
000050   27415270    759750   2.769531   27415270   2.769531
000060  120625000  13175456  10.921875  120625000  10.921875
000070    8564271    742668   8.671875    8564271   8.671875
...           ...       ...        ...        ...        ...
383220    7661415    833803  10.882812    7661415  10.882812
383800   76280690  11459734  15.023438   76280690  15.023438
38380K    1465285    138831   9.468750    1465285   9.468750
900140   99455297  16400685  16.484375   99455297  16.484375
950210   60096155  38344916  63.812500   60096155  63.812500

[927 rows x 5 columns]
</pre>
두 번째 파라미터 market은 코스피(KOSPI)/코스닥(KOSDAQ)/코넥스(KONEX) 시장을 지정해서 조회





```python
df = stock.get_exhaustion_rates_of_foreign_investment_by_ticker('20220704', "KOSPI")
df.head()
```

<pre>
            상장주식수      보유수량        지분율       한도수량      한도소진률
티커                                                          
000020   27931470   1373627   4.921875   27931470   4.921875
000040   96137631  43726900  45.468750   96137631  45.468750
000050   27415270    312610   1.139648   27415270   1.139648
000060  120625000  13443109  11.140625  120625000  11.140625
000070    8564271    651178   7.601562    8564271   7.601562
</pre>
